{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "brand_dna_run",
  "type": "object",
  "required": [
    "run_metadata",
    "per_site",
    "blended",
    "diagnostics"
  ],
  "properties": {
    "run_metadata": {
      "type": "object",
      "required": [
        "run_id",
        "timestamp",
        "tool_settings",
        "urls"
      ],
      "properties": {
        "run_id": {
          "type": "string"
        },
        "timestamp": {
          "type": "string"
        },
        "tool_settings": {
          "type": "object"
        },
        "urls": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "pages_visited_count": {
          "type": "integer"
        }
      },
      "additionalProperties": true
    },
    "per_site": {
      "type": "array",
      "items": {
        "$ref": "#/$defs/site_run"
      }
    },
    "blended": {
      "type": "object",
      "required": [
        "composite_signals",
        "composite_prompt_pack",
        "conflicts",
        "resolutions",
        "provenance_map"
      ],
      "properties": {
        "composite_signals": {
          "$ref": "#/$defs/extracted_signals"
        },
        "composite_prompt_pack": {
          "$ref": "#/$defs/prompt_pack"
        },
        "conflicts": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/conflict"
          }
        },
        "resolutions": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/resolution"
          }
        },
        "provenance_map": {
          "type": [
            "object",
            "array"
          ],
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "diagnostics": {
      "type": "object",
      "properties": {
        "failures": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "warnings": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "skipped_pages": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "low_confidence_areas": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    }
  },
  "$defs": {
    "site_run": {
      "type": "object",
      "required": [
        "site_id",
        "root_url",
        "crawl_metadata",
        "pages",
        "extracted_signals",
        "evidence_map",
        "prompt_pack"
      ],
      "properties": {
        "site_id": {
          "type": "string"
        },
        "root_url": {
          "type": "string"
        },
        "weight": {
          "type": "number"
        },
        "crawl_metadata": {
          "type": "object",
          "properties": {
            "max_depth": {
              "type": "integer"
            },
            "max_pages": {
              "type": "integer"
            },
            "render_js": {
              "type": "boolean"
            },
            "include_paths": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "exclude_paths": {
              "type": "array",
              "items": {
                "type": "string"
              }
            },
            "pages_visited_count": {
              "type": "integer"
            }
          },
          "additionalProperties": true
        },
        "pages": {
          "type": "array",
          "items": {
            "$ref": "#/$defs/page"
          }
        },
        "extracted_signals": {
          "$ref": "#/$defs/extracted_signals"
        },
        "evidence_map": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": {
              "$ref": "#/$defs/evidence"
            }
          }
        },
        "prompt_pack": {
          "$ref": "#/$defs/prompt_pack"
        },
        "limitations": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "diagnostics": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "page": {
      "type": "object",
      "required": [
        "page_id",
        "url",
        "status"
      ],
      "properties": {
        "page_id": {
          "type": "string"
        },
        "url": {
          "type": "string"
        },
        "status": {
          "type": "integer"
        },
        "fetched_at": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "meta_description": {
          "type": "string"
        },
        "headings": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "main_text": {
          "type": "string"
        },
        "html": {
          "type": "string"
        },
        "css_links": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "inline_css": {
          "type": "string"
        },
        "style_snapshot": {
          "type": "object",
          "additionalProperties": true
        },
        "images": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "screenshot": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "extracted_signals": {
      "type": "object",
      "required": [
        "colours",
        "typography",
        "tokens",
        "components",
        "imagery",
        "iconography",
        "motion",
        "voice",
        "personality"
      ],
      "properties": {
        "colours": {
          "$ref": "#/$defs/colours"
        },
        "typography": {
          "type": "object",
          "additionalProperties": true
        },
        "tokens": {
          "type": "object",
          "additionalProperties": true
        },
        "components": {
          "type": "object",
          "additionalProperties": true
        },
        "imagery": {
          "type": "object",
          "additionalProperties": true
        },
        "iconography": {
          "type": "object",
          "additionalProperties": true
        },
        "motion": {
          "type": "object",
          "additionalProperties": true
        },
        "voice": {
          "type": "object",
          "additionalProperties": true
        },
        "personality": {
          "type": "object",
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "colours": {
      "type": "object",
      "required": [
        "primary",
        "secondary",
        "accent",
        "background",
        "text"
      ],
      "properties": {
        "primary": {
          "$ref": "#/$defs/colour_role"
        },
        "secondary": {
          "$ref": "#/$defs/colour_role"
        },
        "accent": {
          "$ref": "#/$defs/colour_role"
        },
        "background": {
          "$ref": "#/$defs/colour_role"
        },
        "text": {
          "$ref": "#/$defs/colour_role"
        },
        "notes": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    },
    "colour_role": {
      "type": "object",
      "required": [
        "hex",
        "confidence"
      ],
      "properties": {
        "hex": {
          "type": "string",
          "pattern": "^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$"
        },
        "usage_notes": {
          "type": "string"
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "needs_human_review": {
          "type": "boolean"
        }
      },
      "additionalProperties": true
    },
    "evidence": {
      "type": "object",
      "required": [
        "source_url"
      ],
      "properties": {
        "source_url": {
          "type": "string"
        },
        "page_id": {
          "type": "string"
        },
        "selector": {
          "type": "string"
        },
        "excerpt": {
          "type": "string"
        },
        "note": {
          "type": "string"
        }
      },
      "additionalProperties": true
    },
    "prompt_pack": {
      "type": "object",
      "required": [
        "brand_style_prompt",
        "visual_direction_prompt",
        "ui_direction_prompt",
        "copywriting_prompt",
        "negative_prompt",
        "token_set"
      ],
      "properties": {
        "brand_style_prompt": {
          "type": "string"
        },
        "visual_direction_prompt": {
          "type": "string"
        },
        "ui_direction_prompt": {
          "type": "string"
        },
        "copywriting_prompt": {
          "type": "string"
        },
        "negative_prompt": {
          "type": "string"
        },
        "token_set": {
          "type": [
            "object",
            "string"
          ],
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "conflict": {
      "type": "object",
      "required": [
        "type",
        "description",
        "affected_signals",
        "sources"
      ],
      "properties": {
        "type": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "affected_signals": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "sources": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    },
    "resolution": {
      "type": "object",
      "required": [
        "decision",
        "rationale",
        "chosen_sources",
        "blend_mode"
      ],
      "properties": {
        "decision": {
          "type": "string"
        },
        "rationale": {
          "type": "string"
        },
        "chosen_sources": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "blend_mode": {
          "type": "string"
        },
        "evidence_anchors": {
          "type": "array",
          "items": {
            "type": "string"
          }
        }
      },
      "additionalProperties": true
    }
  },
  "additionalProperties": true
}