{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.local/design_tokens.schema.json",
  "title": "Design Tokens Schema",
  "type": "object",
  "required": ["run_metadata", "per_site_tokens", "composite_tokens", "conflicts", "resolutions"],
  "properties": {
    "run_metadata": {
      "type": "object",
      "required": ["run_id", "timestamp_utc", "config"],
      "properties": {
        "run_id": { "type": "string" },
        "timestamp_utc": { "type": "string" },
        "config": { "type": "object" }
      },
      "additionalProperties": true
    },
    "per_site_tokens": {
      "type": "array",
      "items": { "$ref": "#/$defs/site_tokens" }
    },
    "composite_tokens": {
      "type": "object",
      "required": ["colour", "typography", "spacing", "radius", "elevation", "motion", "voice_hints"],
      "properties": {
        "colour": { "$ref": "#/$defs/colour_tokens" },
        "typography": { "$ref": "#/$defs/typography_tokens" },
        "spacing": { "$ref": "#/$defs/spacing_tokens" },
        "radius": { "$ref": "#/$defs/radius_tokens" },
        "elevation": { "$ref": "#/$defs/elevation_tokens" },
        "motion": { "$ref": "#/$defs/motion_tokens" },
        "voice_hints": { "type": "object", "additionalProperties": true },
        "provenance": { "type": "object", "additionalProperties": true }
      },
      "additionalProperties": true
    },
    "conflicts": { "type": "array", "items": { "type": "object" } },
    "resolutions": { "type": "array", "items": { "type": "object" } }
  },
  "$defs": {
    "site_tokens": {
      "type": "object",
      "required": ["site_id", "weight", "tokens", "evidence_map"],
      "properties": {
        "site_id": { "type": "string" },
        "weight": { "type": "number", "minimum": 0, "maximum": 1 },
        "confidence": { "type": "number", "minimum": 0, "maximum": 1 },
        "needs_human_review": { "type": "boolean" },
        "tokens": {
          "type": "object",
          "required": ["colour", "typography", "spacing", "radius", "elevation", "motion"],
          "properties": {
            "colour": { "$ref": "#/$defs/colour_tokens" },
            "typography": { "$ref": "#/$defs/typography_tokens" },
            "spacing": { "$ref": "#/$defs/spacing_tokens" },
            "radius": { "$ref": "#/$defs/radius_tokens" },
            "elevation": { "$ref": "#/$defs/elevation_tokens" },
            "motion": { "$ref": "#/$defs/motion_tokens" }
          },
          "additionalProperties": true
        },
        "evidence_map": {
          "type": "object",
          "additionalProperties": {
            "type": "array",
            "items": { "$ref": "#/$defs/evidence" }
          }
        }
      },
      "additionalProperties": true
    },
    "colour_tokens": {
      "type": "object",
      "required": ["primary", "secondary", "accent", "background", "text"],
      "properties": {
        "primary": { "type": "string" },
        "secondary": { "type": "string" },
        "accent": { "type": "string" },
        "background": { "type": "string" },
        "text": { "type": "string" },
        "themes": {
          "type": "object",
          "properties": {
            "dark": {
              "type": "object",
              "additionalProperties": { "type": "string" }
            }
          },
          "additionalProperties": true
        }
      },
      "additionalProperties": true
    },
    "typography_tokens": {
      "type": "object",
      "properties": {
        "body": { "type": "object", "additionalProperties": true },
        "headings": { "type": "object", "additionalProperties": true },
        "ui": { "type": "object", "additionalProperties": true }
      },
      "additionalProperties": true
    },
    "spacing_tokens": {
      "type": "object",
      "properties": {
        "step": { "type": ["integer", "null"] },
        "scale": { "type": "array", "items": { "type": "integer" } }
      },
      "additionalProperties": true
    },
    "radius_tokens": {
      "type": "object",
      "properties": {
        "scale": { "type": "array", "items": { "type": "integer" } }
      },
      "additionalProperties": true
    },
    "elevation_tokens": {
      "type": "object",
      "properties": {
        "shadows": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": true
    },
    "motion_tokens": {
      "type": "object",
      "properties": {
        "transition_durations_ms": { "type": "array", "items": { "type": "integer" } },
        "timing_functions": { "type": "array", "items": { "type": "string" } },
        "notes": { "type": "array", "items": { "type": "string" } }
      },
      "additionalProperties": true
    },
    "evidence": {
      "type": "object",
      "required": ["type"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "excerpt",
            "selector",
            "css_variable",
            "computed_style",
            "computed_style_diff",
            "screenshot"
          ]
        },
        "page_url": { "type": "string" },
        "selector": { "type": "string" },
        "excerpt": { "type": "string" },
        "css_asset_url": { "type": "string" },
        "var_name": { "type": "string" },
        "property": { "type": "string" },
        "value": { "type": "string" },
        "from": { "type": "string" },
        "to": { "type": "string" },
        "state": { "type": "string" },
        "viewport": { "type": "string" },
        "media_mode": { "type": "string" },
        "path_or_url": { "type": "string" }
      },
      "additionalProperties": true
    }
  }
}
